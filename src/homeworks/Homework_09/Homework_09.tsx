import { useState, useEffect } from "react";
import axios from "axios";

import Button from "components/Button/Button";

import { RANDOM_JOKE_URL } from "./data";
import { PageWrapper, Text, JokeContainer, Card, ErrorText } from "./styles";

function Homework_09() {
  const [joke, setJoke] = useState<undefined | string>(undefined);
  const [error, setError] = useState<undefined | string>(undefined);
  const [isDisabled, setIsDisabled] = useState<boolean>(false);

  const getJoke = async () => {
    setJoke(undefined);   // —á–∏—Å—Ç–∏–º State –¥–∞–Ω–Ω—ã–µ —à—É—Ç–∫–∏,—á—Ç–æ–±—ã –Ω–µ–ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —à—É—Ç–∫—É –∏ –æ—à–∏–±–∫—É
    setError(undefined);  // —á–∏—Å—Ç–∏–º State –¥–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏,—á—Ç–æ–±—ã –Ω–µ–ø–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    setIsDisabled(true);

    //=========================================================================
    //=========================================================================
    // –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É axios
    try {
      const response = await axios.get(RANDOM_JOKE_URL);
      const data = response.data;
      // —Ç—É—Ç –ø–∏—à–µ–º –ª–æ–≥–∏–∫—É, –∫–æ–≥–¥–∞ –Ω–∞–º –ø—Ä–∏—à–ª–∞ —à—É—Ç–∫–∞(—Å—Ç–∞—Ç—É—Å –ø—Ä–æ–º–∏—Å–∞ fullfiled)
      setJoke(`${data.setup} ${data.punchline}`);
    } catch (error: any) {
      // —Ç—É—Ç –ø–∏—à–µ–º –ª–æ–≥–∏–∫—É, –∫–æ–≥–¥–∞ –Ω–∞–º –ø—Ä–∏—à–ª–∞ –æ—à–∏–±–∫–∞(—Å—Ç–∞—Ç—É—Å –ø—Ä–æ–º–∏—Å–∞ rejected)
      console.log(error);
      setError(error.message);
    } finally {
      setIsDisabled(false);
    }

//     try { ... }
// –í—Å—ë, —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ try, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –ï—Å–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω),
//  —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ catch.

// await axios.get(RANDOM_JOKE_URL);

// axios.get() ‚Üí –¥–µ–ª–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å (GET) –∫ API –ø–æ –∞–¥—Ä–µ—Å—É RANDOM_JOKE_URL.

// await ‚Üí –≥–æ–≤–æ—Ä–∏—Ç JS –¥–æ–∂–¥–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–ø—Ä–æ–º–∏—Å–∞).

// response ‚Üí –æ–±—ä–µ–∫—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (—Å–æ–¥–µ—Ä–∂–∏—Ç data, status, headers –∏ —Ç. –¥.).

// const data = response.data;
// –í axios –ø–æ–ª–µ–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –≤ —Å–≤–æ–π—Å—Ç–≤–µ .data (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—ä–µ–∫—Ç —Å —à—É—Ç–∫–æ–π).

// setJoke(${data.setup} ${data.punchline});
// –í React –º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ joke, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—É—é —à—É—Ç–∫—É (–æ–±—ã—á–Ω–æ API –¥–ª—è —à—É—Ç–æ–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç setup + punchline).

// catch (error: any) { ... }
// –°—é–¥–∞ –ø–æ–ø–∞–¥—ë–º, –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —É–ø–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏–ª–∏ –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞).

// console.log(error) ‚Üí –ø–µ—á–∞—Ç–∞–µ—Ç –æ—à–∏–±–∫—É.

// setError(error.message) ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–≤–µ—Å—Ç–∏ –Ω–∞ —ç–∫—Ä–∞–Ω.

// finally { ... }
// –≠—Ç–æ—Ç –±–ª–æ–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞.

// setIsDisabled(false); ‚Üí –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–Ω–æ–≤–∞ –≤–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É (–∫–æ—Ç–æ—Ä—É—é –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –æ—Ç–∫–ª—é—á–∞–ª–∏,
//    —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∫–ª–∏–∫–∞–ª 10 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥).

// üîπ –ò—Ç–æ–≥

// try ‚Üí –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —É—Å–ø–µ—Ö.

// catch ‚Üí –ª–æ–≤–∏–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏.

// finally ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ–º ¬´—É–±–æ—Ä–∫—É¬ª (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UI).


    //=======================================================================
    //=======================================================================

    // –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ fetch()
    // const response = await fetch(RANDOM_JOKE_URL);
    // // –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ result –±—É–¥–µ—Ç –ª–µ–∞–∂—Ç—å –ª–∏–±–æ –æ—à–∏–±–∫–∞(promise –≤–µ–Ω–µ—Ç —Å—Ç–∞—Ç—É—Å rejected), –ª–∏–±–æ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏—à–µ–¥—à–∏–µ –¥–∞–Ω–Ω—ã–µ(promise –≤–µ—Ä–Ω–µ—Ç —Å—Ç–∞—Ç—É—Ç fullfiled)
    // const result = await response.json();

    // if (response.ok) {
    //   // —Ç—É—Ç –ø–∏—à–µ–º –ª–æ–≥–∏–∫—É, –∫–æ–≥–¥–∞ –Ω–∞–º –ø—Ä–∏—à–ª–∞ —à—É—Ç–∫–∞(—Å—Ç–∞—Ç—É—Å –ø—Ä–æ–º–∏—Å–∞ fullfiled)
    //   setIsDisabled(false);
    //   setJoke(`${result.setup} ${result.punchline}`);
    // } else {
    //   // —Ç—É—Ç –ø–∏—à–µ–º –ª–æ–≥–∏–∫—É, –∫–æ–≥–¥–∞ –Ω–∞–º –ø—Ä–∏—à–ª–∞ –æ—à–∏–±–∫–∞(—Å—Ç–∞—Ç—É—Å –ø—Ä–æ–º–∏—Å–∞ rejected)
    //   setIsDisabled(false);
    //   setError("Some Network Error");
    // }
    //========================================================================
  };

  useEffect(() => {    //? useEffect –∏–º–µ–µ—Ç 2 –∞—Ä–≥—É–º–µ–Ω—Ç–∞. () => {} -—Ñ—É–Ω–∫—Ü–∏—è , [] -–∏ –∫–æ–≥–¥–∞ –≤—ã–ø–æ–ª-—Å—è —Ñ-—è
    getJoke();
  }, []);             //? –µ—Å–ª–∏ –º–∞—Å—Å–∏–≤ –ø—É—Å—Ç–æ–π ,–≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è 1 —Ä–∞–∑

  return (
    <PageWrapper>
      <Card>
        <JokeContainer>
           {/* {<Text>{joke}</Text>} - –≤—ã–≤–æ–¥–∏–º —à—É—Ç–∫—É –≤ –∫–∞—Ä—Ç–æ—á–∫—É */}
          {!!joke && <Text>{joke}</Text>} 
           {/* –µ—Å–ª–∏ !!joke && = false, —Ç–æ <Text>{joke}</Text> =–Ω–µ–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç */}
           
          {/* {<ErrorText>{error}</ErrorText>}  - –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É –≤ –∫–∞—Ä—Ç–æ—á–∫—É */}
          {!!error && <ErrorText>{error}</ErrorText>}
        </JokeContainer>
        <Button disabled={isDisabled} name="Get new joke" onClick={getJoke} />
      </Card>
    </PageWrapper>
  );
}

export default Homework_09;


// –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–ø–æ–µ–Ω—Ç Homework_09. –í –Ω–µ–º –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ:

// –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ Homework_09, —Å–¥–µ–ª–∞–π—Ç–µ GET –∑–∞–ø—Ä–æ—Å –Ω–∞ api —Å–µ—Ä–≤–∏—Å: https://official-joke-api.appspot.com/random_joke
// –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ, —Ç–æ –ø–æ–ª–æ–∂–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ —à—É—Ç–∫–∞–º–∏ –≤ state –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç–µ –∏—Ö –≤ –∫–∞—Ä—Ç–æ—á–∫–µ.

// –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π, —Å–æ–∑–¥–∞–π—Ç–µ —Å—Ç–µ–π—Ç —Å –æ—à–∏–±–∫–æ–π –∏ –ø–æ–ª–æ–∂–∏—Ç–µ —Ç—É–¥–∞ —Å—Ç—Ä–æ–∫—É "Some Network Error"

// –¥–æ–±–∞–≤—å—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–Ω–æ–ø–∫—É, –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ https://official-joke-api.appspot.com/random_joke –∏ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å—Ç–µ–π—Ç —Å –æ—à–∏–±–∫–æ–π –∏–ª–∏ —Å—Ç–µ–π—Ç–æ–º —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
// —Å—Ç–∏–ª–∏ –Ω–∞ –≤–∞—à–∏ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ